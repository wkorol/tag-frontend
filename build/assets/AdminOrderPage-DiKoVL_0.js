import{d as se,u as re,e as ne,k as ae,E as ie,n as de,r as u,j as e,L as le,l as ce,G as _}from"./index-B2OW2OZc.js";import{u as oe,p as me,f as J,g as b}from"./currency-DyPUPs9K.js";import{C as ue}from"./calendar-BJZpP6iy.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],W=se("circle-x",xe),pe={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",price_proposed:"bg-blue-100 text-blue-800",completed:"bg-emerald-100 text-emerald-800",failed:"bg-orange-100 text-orange-800"},he=t=>{if(!t)return null;try{return JSON.parse(t)}catch{return null}},w=t=>{var h;const l=t.trim();return(h={Airport:"Lotnisko",Flughafen:"Lotnisko",Lentokenttä:"Lotnisko",Flyplass:"Lotnisko",Flygplats:"Lotnisko",Lufthavn:"Lotnisko",Lotnisko:"Lotnisko","Gdańsk City Center":"Centrum Gdańska","Gdańsk Zentrum":"Centrum Gdańska","Gdańsk centrum":"Centrum Gdańska","Gdańsk sentrum":"Centrum Gdańska","Gdańskin keskusta":"Centrum Gdańska","Centrum Gdańska":"Centrum Gdańska","Gdynia City Center":"Centrum Gdyni","Gdynia Zentrum":"Centrum Gdyni","Gdynia centrum":"Centrum Gdyni","Gdynia sentrum":"Centrum Gdyni","Gdynian keskusta":"Centrum Gdyni","Centrum Gdyni":"Centrum Gdyni"}[l])!=null?h:t},ge=t=>{const l=t.replace(/\D/g,"");return l?l.startsWith("48")?l:l.length===9?`48${l}`:l.length===10&&l.startsWith("0")?`48${l.slice(1)}`:l:null},fe=(t,l)=>{const f=ge(t);if(!f)return null;const h=`Cześć ${l}, tu Taxi Airport Gdańsk.`;return`https://wa.me/${f}?text=${encodeURIComponent(h)}`};function ye(){var F,I,A,q,B,D,z,M;const{t,locale:l,setLocale:f}=re(),h="pl",v=ce(h);ne(t.adminOrder.title);const Z=ae(),{id:m}=ie(),[H]=de(),o=(F=H.get("token"))!=null?F:"",[s,V]=u.useState(null),[N,y]=u.useState(!0),[C,k]=u.useState(null),[E,c]=u.useState(null),[L,S]=u.useState(""),[T,X]=u.useState(""),[$,K]=u.useState({phone:!1,email:!1,flight:!1}),[g,p]=u.useState(!1),R=oe(),Q=i=>{const d=Number(i),n=d>0?J(d,R):null;return e.jsxs("div",{className:"leading-tight",children:[e.jsxs("div",{className:"text-slate-900",children:[i," PLN"]}),e.jsx("div",{className:"min-h-[16px] text-xs text-slate-500",children:n!=null?n:""})]})},r=u.useMemo(()=>he(s==null?void 0:s.additionalNotes),[s==null?void 0:s.additionalNotes]),G=u.useMemo(()=>{if(!(s!=null&&s.date)||!(s!=null&&s.pickupTime))return null;const i=s.pickupTime.match(/^(\d{1,2}):(\d{2})/);if(!i)return null;const d=Number(i[1]),n=Number(i[2]);if(Number.isNaN(d)||Number.isNaN(n))return null;const a=new Date(`${s.date}T00:00:00`);return Number.isNaN(a.getTime())?null:(a.setHours(d,n,0,0),a)},[s==null?void 0:s.date,s==null?void 0:s.pickupTime]),P=(s==null?void 0:s.status)==="confirmed"&&G&&G.getTime()<Date.now();u.useEffect(()=>{me()},[]);const j=()=>{if(!m||!o){k(t.adminOrder.missingToken),y(!1);return}const i=b();y(!0),fetch(`${i}/api/admin/orders/${m}?token=${encodeURIComponent(o)}`).then(async d=>{var a;const n=await d.json().catch(()=>null);if(!d.ok)throw new Error((a=n==null?void 0:n.error)!=null?a:t.adminOrder.errorLoad);return n}).then(d=>{var n;V(d),S((n=d==null?void 0:d.proposedPrice)!=null?n:""),k(null)}).catch(d=>{k(d.message)}).finally(()=>y(!1))};u.useEffect(()=>{l!==h&&f(h),j()},[m,o,l,f]);const O=async i=>{var n;if(!m||!o)return;p(!0),c(null);const d=b();try{const a=await fetch(`${d}/api/admin/orders/${m}/decision?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),x=await a.json().catch(()=>null);if(!a.ok)throw new Error((n=x==null?void 0:x.error)!=null?n:"Failed to update order.");c(t.adminOrder.updated),j()}catch(a){c(a instanceof Error?a.message:t.adminOrder.updateError)}finally{p(!1)}},Y=async()=>{var d;if(!m||!o||!window.confirm(t.adminOrder.cancelConfirmedConfirm))return;p(!0),c(null);const i=b();try{const n=await fetch(`${i}/api/admin/orders/${m}/cancel?token=${encodeURIComponent(o)}`,{method:"POST"}),a=await n.json().catch(()=>null);if(!n.ok)throw new Error((d=a==null?void 0:a.error)!=null?d:t.adminOrder.updateError);c(t.adminOrder.cancelConfirmedSuccess),j()}catch(n){c(n instanceof Error?n.message:t.adminOrder.updateError)}finally{p(!1)}},ee=async()=>{var d;if(!m||!o||!window.confirm(t.adminOrder.deleteRejectedConfirm))return;p(!0),c(null);const i=b();try{const n=await fetch(`${i}/api/admin/orders/${m}/delete?token=${encodeURIComponent(o)}`,{method:"DELETE"});if(!n.ok){const a=await n.json().catch(()=>null);throw new Error((d=a==null?void 0:a.error)!=null?d:t.adminOrder.updateError)}c(t.adminOrder.deleteRejectedSuccess),Z(`${v}/admin?token=${encodeURIComponent(o)}`,{replace:!0})}catch(n){c(n instanceof Error?n.message:t.adminOrder.updateError)}finally{p(!1)}},U=async i=>{var n;if(!m||!o)return;p(!0),c(null);const d=b();try{const a=await fetch(`${d}/api/admin/orders/${m}/fulfillment?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:i})}),x=await a.json().catch(()=>null);if(!a.ok)throw new Error((n=x==null?void 0:x.error)!=null?n:"Failed to update order.");c(t.adminOrder.statusUpdated),j()}catch(a){c(a instanceof Error?a.message:t.adminOrder.updateError)}finally{p(!1)}},te=async()=>{var n;if(!m||!o)return;const i=Object.entries($).filter(([,a])=>a).map(([a])=>a);if(i.length===0){c(t.adminOrder.updateRequestSelect);return}p(!0),c(null);const d=b();try{const a=await fetch(`${d}/api/admin/orders/${m}/request-update?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fields:i})}),x=await a.json().catch(()=>null);if(!a.ok)throw new Error((n=x==null?void 0:x.error)!=null?n:t.adminOrder.updateRequestError);c(t.adminOrder.updateRequestSent)}catch(a){c(a instanceof Error?a.message:t.adminOrder.updateRequestError)}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-50 px-4 py-10",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl text-slate-900",children:t.adminOrder.title}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.subtitle})]}),(s==null?void 0:s.canViewAll)&&e.jsx(le,{to:`${v}/admin?token=${encodeURIComponent(o)}`,className:"text-sm text-blue-600 hover:text-blue-700",children:t.adminOrder.back})]}),N&&e.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-6 text-slate-600",children:t.adminOrder.loading}),!N&&C&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-6 text-red-700",children:C}),!N&&s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl text-slate-900",children:[t.adminOrder.orderLabel," #",s.generatedId]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[t.adminOrder.idLabel,": ",s.id]})]}),e.jsx("span",{className:`inline-flex rounded-full px-3 py-1 text-xs font-medium ${(I=pe[s.status])!=null?I:"bg-slate-100 text-slate-700"}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.customerLabel}),e.jsx("div",{className:"text-slate-900",children:s.fullName}),e.jsx("div",{className:"text-sm text-slate-600",children:s.emailAddress}),(()=>{const i=fe(s.phoneNumber,s.fullName);return i?e.jsx("a",{className:"text-sm text-slate-600 underline underline-offset-2 hover:text-emerald-600",href:i,target:"_blank",rel:"noreferrer",children:s.phoneNumber}):e.jsx("div",{className:"text-sm text-slate-600",children:s.phoneNumber})})()]}),e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.pickupLabel}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-900",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-600"}),s.date," ",s.pickupTime]}),e.jsx("div",{className:"text-sm text-slate-600",children:w(s.pickupAddress)})]})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.priceLabel}),Q(s.proposedPrice),s.pendingPrice&&e.jsx("div",{className:"text-sm text-blue-700",children:t.adminOrder.pendingPrice(s.pendingPrice)})]}),e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.additionalInfo}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.passengers," ",(A=r==null?void 0:r.passengers)!=null?A:"—"]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.largeLuggage," ",(q=r==null?void 0:r.largeLuggage)!=null?q:"—"]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.pickupType," ",(B=r==null?void 0:r.pickupType)!=null?B:"—"]}),(r==null?void 0:r.signService)&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.signService," ",r.signService==="sign"?t.adminOrder.signServiceSign:t.adminOrder.signServiceSelf]}),typeof(r==null?void 0:r.signFee)=="number"&&r.signFee>0&&e.jsxs("div",{className:"text-sm text-slate-700 leading-tight",children:[e.jsxs("div",{children:[t.adminOrder.signFee," ",r.signFee," PLN"]}),e.jsx("div",{className:"min-h-[16px] text-xs text-slate-500",children:(D=J(r.signFee,R))!=null?D:""})]}),(r==null?void 0:r.pickupType)==="airport"&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.flightNumber," ",s.flightNumber||"—"]}),(r==null?void 0:r.signText)&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.signText," ",r.signText]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.route," ",(z=r==null?void 0:r.route)!=null&&z.from?w(r.route.from):"—"," →"," ",(M=r==null?void 0:r.route)!=null&&M.to?w(r.route.to):"—"]}),(r==null?void 0:r.notes)&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.notes," ",r.notes]})]})]})]}),E&&e.jsx("div",{className:"rounded-xl border border-blue-200 bg-blue-50 p-4 text-sm text-blue-700",children:E}),s.status==="pending"&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.adminActions}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("button",{className:"flex items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-3 text-white hover:bg-green-700 transition-colors",disabled:g,onClick:()=>O({action:"confirm"}),children:[e.jsx(_,{className:"h-4 w-4"}),t.adminOrder.confirmOrder]}),e.jsxs("button",{className:"flex items-center justify-center gap-2 rounded-lg bg-red-600 px-4 py-3 text-white hover:bg-red-700 transition-colors",disabled:g,onClick:()=>O({action:"reject",message:T}),children:[e.jsx(W,{className:"h-4 w-4"}),t.adminOrder.rejectOrder]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-700",children:t.adminOrder.proposePrice}),e.jsx("input",{type:"text",value:L,onChange:i=>S(i.target.value),className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2"}),e.jsx("button",{className:"mt-3 w-full rounded-lg border border-blue-600 px-4 py-2 text-blue-700 hover:bg-blue-50 transition-colors",disabled:g,onClick:()=>O({action:"price",price:L}),children:t.adminOrder.sendPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-700",children:t.adminOrder.rejectionReason}),e.jsx("textarea",{value:T,onChange:i=>X(i.target.value),rows:4,className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2"})]})]})]}),(s.status==="pending"||s.status==="confirmed")&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.requestUpdate}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.requestUpdateBody}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:["phone","email","flight"].map(i=>e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700",children:[e.jsx("input",{type:"checkbox",checked:$[i],onChange:d=>K(n=>({...n,[i]:d.target.checked}))}),i==="phone"?t.adminOrder.fieldPhone:i==="email"?t.adminOrder.fieldEmail:t.adminOrder.fieldFlight]},i))}),e.jsx("button",{className:"w-full rounded-lg border border-red-600 px-4 py-2 text-red-700 hover:bg-red-50 transition-colors",disabled:g,onClick:te,children:t.adminOrder.requestUpdateAction})]}),s.status==="confirmed"&&!P&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.cancelConfirmedTitle}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.cancelConfirmedBody}),e.jsx("button",{className:"w-full rounded-lg bg-red-600 px-4 py-2 text-white hover:bg-red-700 transition-colors",disabled:g,onClick:Y,children:t.adminOrder.cancelConfirmedAction})]}),s.status==="rejected"&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.deleteRejectedTitle}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.deleteRejectedBody}),e.jsx("button",{className:"w-full rounded-lg border border-red-600 px-4 py-2 text-red-700 hover:bg-red-50 transition-colors",disabled:g,onClick:ee,children:t.adminOrder.deleteRejectedAction})]}),P&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg text-slate-900 mb-3",children:t.adminOrder.completionTitle}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-3 text-white hover:bg-green-700 transition-colors",disabled:g,onClick:()=>{window.confirm(t.adminOrder.markCompletedConfirm)&&U("completed")},children:[e.jsx(_,{className:"h-4 w-4"}),t.adminOrder.markCompleted]}),e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg bg-red-600 px-4 py-3 text-white hover:bg-red-700 transition-colors",disabled:g,onClick:()=>{window.confirm(t.adminOrder.markFailedConfirm)&&U("failed")},children:[e.jsx(W,{className:"h-4 w-4"}),t.adminOrder.markFailed]})]})]})]})]})})}export{ye as AdminOrderPage};
