import{c as Z,u as H,a as V,f as X,z as K,y as Q,r as m,j as e,L as Y,l as ee}from"./index-DpEWvY7X.js";import{u as te,p as re,f as U,g}from"./currency-BCsPRnRW.js";import{C as se}from"./calendar-D33YTdFM.js";import{C as F}from"./circle-check-BoCxTL6Z.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],I=Z("circle-x",ae),ne={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",price_proposed:"bg-blue-100 text-blue-800",completed:"bg-emerald-100 text-emerald-800",failed:"bg-orange-100 text-orange-800"},de=t=>{if(!t)return null;try{return JSON.parse(t)}catch{return null}},k=t=>{const i=t.trim();return{Airport:"Lotnisko",Flughafen:"Lotnisko",Lentokenttä:"Lotnisko",Flyplass:"Lotnisko",Flygplats:"Lotnisko",Lufthavn:"Lotnisko",Lotnisko:"Lotnisko","Gdańsk City Center":"Centrum Gdańska","Gdańsk Zentrum":"Centrum Gdańska","Gdańsk centrum":"Centrum Gdańska","Gdańsk sentrum":"Centrum Gdańska","Gdańskin keskusta":"Centrum Gdańska","Centrum Gdańska":"Centrum Gdańska","Gdynia City Center":"Centrum Gdyni","Gdynia Zentrum":"Centrum Gdyni","Gdynia centrum":"Centrum Gdyni","Gdynia sentrum":"Centrum Gdyni","Gdynian keskusta":"Centrum Gdyni","Centrum Gdyni":"Centrum Gdyni"}[i]??t},ie=t=>{const i=t.replace(/\D/g,"");return i?i.startsWith("48")?i:i.length===9?`48${i}`:i.length===10&&i.startsWith("0")?`48${i.slice(1)}`:i:null},le=(t,i)=>{const h=ie(t);if(!h)return null;const f=`Cześć ${i}, tu Taxi Airport Gdańsk.`;return`https://wa.me/${h}?text=${encodeURIComponent(f)}`};function xe(){const{t,locale:i,setLocale:h}=H(),f="pl",w=ee(f);V(t.adminOrder.title);const A=X(),{id:c}=K(),[q]=Q(),o=q.get("token")??"",[s,B]=m.useState(null),[j,N]=m.useState(!0),[v,y]=m.useState(null),[C,l]=m.useState(null),[T,E]=m.useState(""),[L,D]=m.useState(""),[S,z]=m.useState({phone:!1,email:!1,flight:!1}),[p,u]=m.useState(!1),$=te(),M=n=>{const a=Number(n),r=a>0?U(a,$):null;return e.jsxs("div",{className:"leading-tight",children:[e.jsxs("div",{className:"text-slate-900",children:[n," PLN"]}),e.jsx("div",{className:"min-h-[16px] text-xs text-slate-500",children:r??""})]})},d=m.useMemo(()=>de(s?.additionalNotes),[s?.additionalNotes]),R=m.useMemo(()=>{if(!s?.date||!s?.pickupTime)return null;const n=s.pickupTime.match(/^(\d{1,2}):(\d{2})/);if(!n)return null;const a=Number(n[1]),r=Number(n[2]);if(Number.isNaN(a)||Number.isNaN(r))return null;const x=new Date(`${s.date}T00:00:00`);return Number.isNaN(x.getTime())?null:(x.setHours(a,r,0,0),x)},[s?.date,s?.pickupTime]),G=s?.status==="confirmed"&&R&&R.getTime()<Date.now();m.useEffect(()=>{re()},[]);const b=()=>{if(!c||!o){y(t.adminOrder.missingToken),N(!1);return}const n=g();N(!0),fetch(`${n}/api/admin/orders/${c}?token=${encodeURIComponent(o)}`).then(async a=>{const r=await a.json().catch(()=>null);if(!a.ok)throw new Error(r?.error??t.adminOrder.errorLoad);return r}).then(a=>{B(a),E(a?.proposedPrice??""),y(null)}).catch(a=>{y(a.message)}).finally(()=>N(!1))};m.useEffect(()=>{i!==f&&h(f),b()},[c,o,i,h]);const O=async n=>{if(!c||!o)return;u(!0),l(null);const a=g();try{const r=await fetch(`${a}/api/admin/orders/${c}/decision?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),x=await r.json().catch(()=>null);if(!r.ok)throw new Error(x?.error??"Failed to update order.");l(t.adminOrder.updated),b()}catch(r){l(r instanceof Error?r.message:t.adminOrder.updateError)}finally{u(!1)}},_=async()=>{if(!c||!o||!window.confirm(t.adminOrder.cancelConfirmedConfirm))return;u(!0),l(null);const n=g();try{const a=await fetch(`${n}/api/admin/orders/${c}/cancel?token=${encodeURIComponent(o)}`,{method:"POST"}),r=await a.json().catch(()=>null);if(!a.ok)throw new Error(r?.error??t.adminOrder.updateError);l(t.adminOrder.cancelConfirmedSuccess),b()}catch(a){l(a instanceof Error?a.message:t.adminOrder.updateError)}finally{u(!1)}},J=async()=>{if(!c||!o||!window.confirm(t.adminOrder.deleteRejectedConfirm))return;u(!0),l(null);const n=g();try{const a=await fetch(`${n}/api/admin/orders/${c}/delete?token=${encodeURIComponent(o)}`,{method:"DELETE"});if(!a.ok){const r=await a.json().catch(()=>null);throw new Error(r?.error??t.adminOrder.updateError)}l(t.adminOrder.deleteRejectedSuccess),A(`${w}/admin?token=${encodeURIComponent(o)}`,{replace:!0})}catch(a){l(a instanceof Error?a.message:t.adminOrder.updateError)}finally{u(!1)}},P=async n=>{if(!c||!o)return;u(!0),l(null);const a=g();try{const r=await fetch(`${a}/api/admin/orders/${c}/fulfillment?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:n})}),x=await r.json().catch(()=>null);if(!r.ok)throw new Error(x?.error??"Failed to update order.");l(t.adminOrder.statusUpdated),b()}catch(r){l(r instanceof Error?r.message:t.adminOrder.updateError)}finally{u(!1)}},W=async()=>{if(!c||!o)return;const n=Object.entries(S).filter(([,r])=>r).map(([r])=>r);if(n.length===0){l(t.adminOrder.updateRequestSelect);return}u(!0),l(null);const a=g();try{const r=await fetch(`${a}/api/admin/orders/${c}/request-update?token=${encodeURIComponent(o)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fields:n})}),x=await r.json().catch(()=>null);if(!r.ok)throw new Error(x?.error??t.adminOrder.updateRequestError);l(t.adminOrder.updateRequestSent)}catch(r){l(r instanceof Error?r.message:t.adminOrder.updateRequestError)}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-50 px-4 py-10",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl text-slate-900",children:t.adminOrder.title}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.subtitle})]}),s?.canViewAll&&e.jsx(Y,{to:`${w}/admin?token=${encodeURIComponent(o)}`,className:"text-sm text-blue-600 hover:text-blue-700",children:t.adminOrder.back})]}),j&&e.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-6 text-slate-600",children:t.adminOrder.loading}),!j&&v&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-6 text-red-700",children:v}),!j&&s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl text-slate-900",children:[t.adminOrder.orderLabel," #",s.generatedId]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[t.adminOrder.idLabel,": ",s.id]})]}),e.jsx("span",{className:`inline-flex rounded-full px-3 py-1 text-xs font-medium ${ne[s.status]??"bg-slate-100 text-slate-700"}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.customerLabel}),e.jsx("div",{className:"text-slate-900",children:s.fullName}),e.jsx("div",{className:"text-sm text-slate-600",children:s.emailAddress}),(()=>{const n=le(s.phoneNumber,s.fullName);return n?e.jsx("a",{className:"text-sm text-slate-600 underline underline-offset-2 hover:text-emerald-600",href:n,target:"_blank",rel:"noreferrer",children:s.phoneNumber}):e.jsx("div",{className:"text-sm text-slate-600",children:s.phoneNumber})})()]}),e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.pickupLabel}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-900",children:[e.jsx(se,{className:"h-4 w-4 text-blue-600"}),s.date," ",s.pickupTime]}),e.jsx("div",{className:"text-sm text-slate-600",children:k(s.pickupAddress)})]})]}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.priceLabel}),M(s.proposedPrice),s.pendingPrice&&e.jsx("div",{className:"text-sm text-blue-700",children:t.adminOrder.pendingPrice(s.pendingPrice)})]}),e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:t.adminOrder.additionalInfo}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.passengers," ",d?.passengers??"—"]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.largeLuggage," ",d?.largeLuggage??"—"]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.pickupType," ",d?.pickupType??"—"]}),d?.signService&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.signService," ",d.signService==="sign"?t.adminOrder.signServiceSign:t.adminOrder.signServiceSelf]}),typeof d?.signFee=="number"&&d.signFee>0&&e.jsxs("div",{className:"text-sm text-slate-700 leading-tight",children:[e.jsxs("div",{children:[t.adminOrder.signFee," ",d.signFee," PLN"]}),e.jsx("div",{className:"min-h-[16px] text-xs text-slate-500",children:U(d.signFee,$)??""})]}),d?.pickupType==="airport"&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.flightNumber," ",s.flightNumber||"—"]}),d?.signText&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.signText," ",d.signText]}),e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.route," ",d?.route?.from?k(d.route.from):"—"," →"," ",d?.route?.to?k(d.route.to):"—"]}),d?.notes&&e.jsxs("div",{className:"text-sm text-slate-700",children:[t.adminOrder.notes," ",d.notes]})]})]})]}),C&&e.jsx("div",{className:"rounded-xl border border-blue-200 bg-blue-50 p-4 text-sm text-blue-700",children:C}),s.status==="pending"&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.adminActions}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("button",{className:"flex items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-3 text-white hover:bg-green-700 transition-colors",disabled:p,onClick:()=>O({action:"confirm"}),children:[e.jsx(F,{className:"h-4 w-4"}),t.adminOrder.confirmOrder]}),e.jsxs("button",{className:"flex items-center justify-center gap-2 rounded-lg bg-red-600 px-4 py-3 text-white hover:bg-red-700 transition-colors",disabled:p,onClick:()=>O({action:"reject",message:L}),children:[e.jsx(I,{className:"h-4 w-4"}),t.adminOrder.rejectOrder]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-700",children:t.adminOrder.proposePrice}),e.jsx("input",{type:"text",value:T,onChange:n=>E(n.target.value),className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2"}),e.jsx("button",{className:"mt-3 w-full rounded-lg border border-blue-600 px-4 py-2 text-blue-700 hover:bg-blue-50 transition-colors",disabled:p,onClick:()=>O({action:"price",price:T}),children:t.adminOrder.sendPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-700",children:t.adminOrder.rejectionReason}),e.jsx("textarea",{value:L,onChange:n=>D(n.target.value),rows:4,className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2"})]})]})]}),(s.status==="pending"||s.status==="confirmed")&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.requestUpdate}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.requestUpdateBody}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:["phone","email","flight"].map(n=>e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700",children:[e.jsx("input",{type:"checkbox",checked:S[n],onChange:a=>z(r=>({...r,[n]:a.target.checked}))}),n==="phone"?t.adminOrder.fieldPhone:n==="email"?t.adminOrder.fieldEmail:t.adminOrder.fieldFlight]},n))}),e.jsx("button",{className:"w-full rounded-lg border border-red-600 px-4 py-2 text-red-700 hover:bg-red-50 transition-colors",disabled:p,onClick:W,children:t.adminOrder.requestUpdateAction})]}),s.status==="confirmed"&&!G&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.cancelConfirmedTitle}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.cancelConfirmedBody}),e.jsx("button",{className:"w-full rounded-lg bg-red-600 px-4 py-2 text-white hover:bg-red-700 transition-colors",disabled:p,onClick:_,children:t.adminOrder.cancelConfirmedAction})]}),s.status==="rejected"&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-3",children:[e.jsx("h3",{className:"text-lg text-slate-900",children:t.adminOrder.deleteRejectedTitle}),e.jsx("p",{className:"text-sm text-slate-600",children:t.adminOrder.deleteRejectedBody}),e.jsx("button",{className:"w-full rounded-lg border border-red-600 px-4 py-2 text-red-700 hover:bg-red-50 transition-colors",disabled:p,onClick:J,children:t.adminOrder.deleteRejectedAction})]}),G&&e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg text-slate-900 mb-3",children:t.adminOrder.completionTitle}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-3 text-white hover:bg-green-700 transition-colors",disabled:p,onClick:()=>{window.confirm(t.adminOrder.markCompletedConfirm)&&P("completed")},children:[e.jsx(F,{className:"h-4 w-4"}),t.adminOrder.markCompleted]}),e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg bg-red-600 px-4 py-3 text-white hover:bg-red-700 transition-colors",disabled:p,onClick:()=>{window.confirm(t.adminOrder.markFailedConfirm)&&P("failed")},children:[e.jsx(I,{className:"h-4 w-4"}),t.adminOrder.markFailed]})]})]})]})]})})}export{xe as AdminOrderPage};
